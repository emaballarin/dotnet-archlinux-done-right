# Maintainer:   Emanuele Ballarin <emanuele@ballarin.cc>
# Contributor:  Maxime Gauduin <alucryd@archlinux.org>
# Contributor:  Max Liebkies <mail@maxliebkies.de>

pkgbase=dotnet-core-bin
pkgname=('dotnet-host-bin' 'dotnet-runtime-bin' 'aspnet-runtime-bin' 'dotnet-sdk-bin')
pkgver=3.0.100+preview9_014004
_pkgver=3.0.100+preview9_014004
pkgrel=1
arch=('x86_64')
url='https://www.microsoft.com/net/core'
license=('MIT')
makedepends=('clang' 'cmake' 'curl' 'git' 'icu' 'krb5' 'libunwind' 'lldb' 'llvm' 'lttng-ust' 'openssl' 'zlib')
options=('staticlibs')
source=(
  'https://download.visualstudio.microsoft.com/download/pr/d881776c-82d7-4d50-b13c-9a848da46001/d55ce79c2b3a61b303cb826b7c460d20/aspnetcore-runtime-3.0.0-preview9.19424.4-linux-x64.tar.gz'
  'https://download.visualstudio.microsoft.com/download/pr/498b8b41-7626-435e-bea8-878c39ccbbf3/c8df08e881d1bcf9a49a9ff5367090cc/dotnet-sdk-3.0.100-preview9-014004-linux-x64.tar.gz'
  'dotnet.sh'
)
sha256sums=('SKIP'
            'SKIP'
            'SKIP')

package_dotnet-host-bin() {
  pkgdesc='A generic driver for the .NET Core Command Line Interface (3.0 preview version)'
  provides=('dotnet-host' 'dotnet-host-2.2' 'dotnet-host-preview' 'dotnet-host-3.0')
  conflicts=('dotnet-host' 'dotnet-host-2.2' 'dotnet-host-preview' 'dotnet-host-3.0')

  install -dm 755 "${pkgdir}"/{opt/dotnet,usr/share/licenses/dotnet-host}
  cp -dr --no-preserve='ownership' dotnet host "${pkgdir}"/opt/dotnet/
  cp -dr --no-preserve='ownership' LICENSE.txt ThirdPartyNotices.txt "${pkgdir}"/usr/share/licenses/dotnet-host
  install -Dm 755 "${srcdir}"/dotnet.sh "${pkgdir}"/usr/bin/dotnet
}

package_dotnet-runtime-bin() {
  pkgdesc='The .NET Core runtime (3.0 preview version)'
  depends=('dotnet-host-bin' 'icu' 'krb5' 'libunwind' 'openssl' 'zlib' 'libcurl.so' 'lttng-ust')
  provides=('dotnet-runtime' 'dotnet-runtime-2.2' 'dotnet-runtime-preview' 'dotnet-runtime-3.0')
  conflicts=('dotnet-runtime' 'dotnet-runtime-2.2' 'dotnet-runtime-preview' 'dotnet-runtime-3.0')

  install -dm 755 "${pkgdir}"/{opt/dotnet/shared,usr/share/licenses}
  cp -dr --no-preserve='ownership' shared/Microsoft.NETCore.App "${pkgdir}"/opt/dotnet/shared/
  ln -s dotnet-host "${pkgdir}"/usr/share/licenses/dotnet-runtime
}

package_aspnet-runtime-bin() {
  pkgdesc='The ASP.NET Core runtime (3.0 preview version)'
  depends=('dotnet-runtime-bin')
  provides=('aspnet-runtime' 'aspnet-runtime-2.2' 'aspnet-runtime-preview' 'aspnet-runtime-3.0')
  conflicts=('aspnet-runtime' 'aspnet-runtime-2.2' 'aspnet-runtime-preview' 'aspnet-runtime-3.0')

  install -dm 755 "${pkgdir}"/{opt/dotnet/shared,usr/share/licenses}
  cp -dr --no-preserve='ownership' shared/Microsoft.AspNetCore.App "${pkgdir}"/opt/dotnet/shared/
#  cp -dr --no-preserve='ownership' shared/Microsoft.AspNetCore.All "${pkgdir}"/opt/dotnet/shared/
  ln -s dotnet-host "${pkgdir}"/usr/share/licenses/aspnet-runtime
}

package_dotnet-sdk-bin() {
  pkgdesc='The .NET Core SDK (3.0 preview version)'
  depends=('dotnet-runtime-bin')
  provides=('dotnet-sdk' 'dotnet-sdk-2.2' 'dotnet-sdk-preview' 'dotnet-sdk-3.0')
  conflicts=('dotnet-sdk' 'dotnet-sdk-2.2' 'dotnet-sdk-preview' 'dotnet-sdk-3.0')

  install -dm 755 "${pkgdir}"/{opt/dotnet,usr/share/licenses}
  cp -dr --no-preserve='ownership' sdk "${pkgdir}"/opt/dotnet/
  ln -s dotnet-host "${pkgdir}"/usr/share/licenses/dotnet-sdk
}

# vim: ts=2 sw=2 et:
